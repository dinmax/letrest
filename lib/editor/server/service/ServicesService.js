/*! letrest - v0.0.38 - 2016-04-04 */"use strict";function requireUncached(a){return delete require.cache[require.resolve(a)],require(a)}var MODULE="Services Service | ",LOG=require("uw").log,PATH=require("path"),SERVICE_PATH=PATH.dirname(process.mainModule.filename)+"/../config/letrest/services/",SCHEMA_PATH=PATH.dirname(process.mainModule.filename)+"/../config/letrest/schemas/",moment=require("moment"),fs=require("fs"),getServices=function(){var a={};LOG.info(MODULE,"Reading services.");for(var b=require("fs").readdirSync(SERVICE_PATH),c=0;c<b.length;c++)if(".json"==b[c].substr(b[c].length-5)){LOG.info(MODULE,"Processing service file",b[c]);var d=requireUncached(SERVICE_PATH+b[c]);d.name!=b[c].replace(".json","")&&LOG.warn(MODULE,"Service Definition name not match file name =>",b[c]),a[d.name]=d}else LOG.warn(MODULE,"Skipping file "+b[c]);return a},startsWithUntil=function(a,b,c){return 0==c.lastIndexOf(a,0)&&c.lastIndexOf(b)==a.length},saveService=function(a){return LOG.info(MODULE,"Saving service",a.name),saveWithBackup(a.name,a,SERVICE_PATH,"SAVING SERVICE: ")},mkdirSync=function(a){try{fs.mkdirSync(a)}catch(b){if("EEXIST"!=b.code)throw b}},createFolder=function(a){var b=a+"/back",c=b+"/"+moment().format("YYYYMMDD");return mkdirSync(b),mkdirSync(c),c},saveWithBackup=function(a,b,c,d){if(a){var e=a;LOG.info(MODULE,d+e);var f=createFolder(c),g=c+"/"+e+".json";if(fs.existsSync(g)){var h=f+"/"+e+"_"+moment().format("hhmmss")+".json";fs.rename(g,h)}return fs.writeFileSync(g,JSON.stringify(b,null,"	"))}return-1};module.exports.allservice=function(a,b){b.send(getServices())},module.exports.saveservice=function(a,b){b.send(saveService(a.body))};