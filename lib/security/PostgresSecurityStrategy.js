/*! letrest - v0.3.0 - 2016-05-12 */var CONFIG=require("../Config.js").getSecurity().config.STRATEGY,DB=require("uw").DB,Q=require("q"),UTIL=require("util"),CONST_LOGIN_QUERY=UTIL.format("select * from %s where %s='%%s' and %s='%%s'",CONFIG.TABLE,CONFIG.FIELDS.NICK,CONFIG.FIELDS.PASSWORD),MODULE="PGSQL-SECURITY	",LOG=require("uw-log").newInstance(MODULE);exports.register=function(){},exports.getRoles=function(){LOG.info("Retriving available roles");var a=Q.defer();return CONFIG.ROLE_JSON?(LOG.info("Using JSON provided instead query"),a.resolve(CONFIG.ROLE_JSON),a.promise):(DB.query(LOG.show(CONFIG.ROLE_SQL)).then(function(b){a.resolve(b.rows)})["catch"](function(b){LOG.error("Failed to executed credentials query."),a.reject(b)}),a.promise)},exports.login=function(a){LOG.info("Procesing login request for user:",a.username);var b=Q.defer();return DB.query(LOG.show(UTIL.format(CONFIG.LOGIN_SQL||CONST_LOGIN_QUERY,a.username,a.password))).then(function(a){0==a.rows.length?b.resolve(null):b.resolve(a.rows[0])})["catch"](function(a){LOG.error("Failed to executed credentials query."),b.reject(a)}),b.promise},exports.logout=function(){},exports.getServiceExceptions=function(){return LOG.info("Retriving available exceptions"),DB.query(LOG.show(CONFIG.SERVICE_EXCEPTION_SQL)).then(function(a){return a.rows})["catch"](function(a){LOG.error("Failed to executed exceptions query."),promise.reject(a)})};